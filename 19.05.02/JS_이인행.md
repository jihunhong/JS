### 정적 검사를 통한 자바스크립트의 안정성 검사
- eval()과 Function() 생성자는 모든 보안 서브셋에서 허용되지 않는다.
  - 두 함수의 생성자가 임의의 코드 문자열을 실행할 수 있고, 그 문자열들은 정적으로 분석될 수 없기 때문이다.
- this 키워드는 제한되거나 아예 금지되어야 한다.
  - 엄격하지 않은 모드에서 함수가 this를 통해 전역 객체에 접근할 수 있기 때문이다.
  - 전역 객체에 대한 접근을 막는 것은 모든 샌드박싱 시스템의 주요 목적 중 하나다.
- with문의 사용이 금지되어야 한다.
  - with문을 사용한 경우, 정적 코드 검증이 더욱 어려워지기 때문이다.
- Window 객체와 document 객체 사용시 주의할 필요가 있다.
  - 웹 페이지의 제한된 부분에만 접근할 수 있는 커스텀 API를 샌드박스 내의 코드가 사용할 수 있게 제공하도록 한다.
  - 샌드박스 내의 코드가 실행되는 '컨테이너'가 표준 DOM API 중에서 안전한 부분만 구현한 퍼사드나 프락시 document 객체를 제공한다.
- arguments 객체, call()과 apply() 메서드, constructor와 prototype 프로퍼티, __proto__ 같은 비표준 프로퍼티의 사용을 금지한다.
- 대괄호를 통한 프로퍼티 접근 보다는 . 연산자를 통한 프로퍼티 접근을 권장한다.
  - 대괄호를 사용한 임의 문자열 표현식은 정적으로 분석할 수 없기 때문이다.
  - 대괄호에 들어가는 값이 숫자나 문자열 리터럴이 아니라면, 금지하는 것을 권장한다.
- 대표적인 보안 서브셋들
  - ADsafe : 오직 정적 검사에만 의존하며 JSLint를 검증기로 사용한다.
  - dojox.secure : ADsafe와 비슷하지만 표준 DOM API를 사용하는 것을 허용한다.
  - Caja : ECMAScript5의 엄격 모드에 가깝다.
  - FBJS : 코드 변환을 통해 보안성을 유지한다.
  - 마이크로소프트 Web Sandbox : 보안을 위해 효율적으로 구현된 자바스크립트 가상 머신 계층을 두어, 자바스크립트가 이 보안 가상 머신을 통해 실행되도록 한다.

### 상수와 범위 변수
- const 상수 : 상수 선언 이후에 이뤄지는 할당은 무시되고, 재정의를 시도하면 에러가 발생한다.
  - 블록 유효범위가 없으며 상수는 함수 정의부의 최상단으로 hoisted 된다.
- let 변수 : 블록 유효범위가 없다는 자바스크립트의 문제점을 해결하기 위해 등장
  - var 대신에 사용하면 좋다. (for/in 루프 등)
  - var를 사용하여 정의된 변수는 함수 몸체 전체에 유효하지만, let을 사용하여 정의된 변수는 가장 가까운 블록 내에서만 유효하다.

### 해체 할당
- 배열 이나 객체 리터럴 문법과 비슷한 방식으로 여러 개의 변수 이름을 지정하여 할당할 수 있다.
```js
    let [x,y,z] = [1,2]; // x=1, y=2, z=undefined
    [,x,,y] = [1,2,3,4]; // x=2, y=4

    let [one, [twoA, twoB]] = [1, [2,2.5], 3]; // one=1, twoA=2, twoB=2.5
```
- 왼쪽의 변수 선언 부분에 객체와 같은 모양 또한 올 수 있다.
  - 변수 이름이 키 값이 아니라 value 값이 라는 것을 햇깔리지 않도록 주의한다.
```js
    let transparent = {r:0.0, g:0.4, b:0.8, a:1.0};
    let {r:red, g:green, b:blue} = transparent;
    // red=0.0, g=0.4, b=0.8
    // r, g, b는 변수로 할당되지 않는다.
```

### 클라이언트 측 자바스크립트 실행 순서
- 웹 브라우저는 Document 객체를 생성하고 웹 페이지 분석을 시작한다.
- HTML 요소와 그 안의 텍스트 내용을 분석해서 Element 객체와 Text 노드를 웹 페이지 문서에 추가한다.
- 이때, document.readyState 속성값은 loading이다.
- HTML 분석기가 script 요소와 만나면, 문서에 추가하고 내장 스크립트건 외부 파일이건 구분 없이 동기 모드로 실행한다.
- HTML 분석기가 async 속성이 지정된 script 요소를 만나면, 스크립트 텍스트 다운로드를 시작하고 문서 분석도 계속한다.
- 문서 분석이 완료되면, document.readyState 속성값은 interactive로 바뀐다.
- 브라우저는 Document 객체에서 DOMContentLoaded 이벤트를 일으킨다. 이 이벤트는 프로그램 실행 단계가 동기 모드 스크립트 단계에서 비동기 모드인 이벤트 주도 단계로 옮겨갔다는 신호다.
- 브라우저는 이 시점에서 문서를 완전히 분석했지만, 이미지 등 추가로 불러와야 하는 내용을 기다릴 수 있다. 이런 내용 또한 모두 불러오고 모든 비동기 스크립트도 불러와 실행했으면, document.readyState 속성 값은 complete로 바뀐다. 그리고 웹 브라우저는 Window 객체에서 load 이벤트를 발생시킨다.
- 이 시점부터 이벤트 핸들러는 사용자 입력 이벤트, 네트워크 이벤트, 타이머 만료 등의 응답으로 비동기 호출된다.

### 자바스크립트의 제약된 기능들
- 브라우저에서 새 창을 열 수 있다. 하지만 광고주들의 팝업 남용을 막기 위해 대부분의 브라우저는 새 창 열기를 막아 두고 마우스 클릭 같은 행동으로 사용자가 직접 새 창을 열게 한다.
- 자바스크립트는 스스로 연 새 창은 다시 닫을 수 있지만, 다른 창을 닫으려면 사용자가 확인 창에서 승인을 해주어야 한다.
- HTML FileUpload 요소의 value 속성은 값을 불러올 수는 있지만 지정할 수는 없다. 이것이 가능하면 자바스크립트로 원하는 파일을 value 속성에 지정할 수 있으므로, 서버로 특정 파일의 내용(예를 들면 계정 암호)을 업로드하는 폼을 만들 수 있기 때문이다.
- 스크립트는 자신이 실행된 문서의 서버와 다른 서버에서 불러온 문서의 내용은 읽을 수 없다. 비슷한 의미로 스크립트는 다른 서버에서 불러온 문서에 이벤트 리스너를 등록할 수 없다. 이 제약 사항이 다른 페이지에서 사용자 입력을 가로채는 스크립트를 심지 못하게 한다.
